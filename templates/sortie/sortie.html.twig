{% extends 'base.html.twig' %}

{% block title %}
    {{ parent() }} | Détails de la sortie
{% endblock %}

{% block body %}
    <h2>Afficher une sortie</h2>
    <p>Nom de la sortie : {{ sortie.nom|capitalize }}</p>
    <p>Date et heure de la sortie : {{ sortie.dateHeureDebut|date("d/m/Y h:i") }}</p>
    <p>Date limite d'inscription : {{ sortie.dateLimiteInscription|date("d/m/Y") }}</p>
    <p>Nombre de places : {{ sortie.nbInscriptionMax }}</p>
    <p>Durée : {{ sortie.duree }} minutes</p>
    <label for="description">Description et infos : </label>
    <textarea id="description">{{ sortie.infosSortie }}</textarea>
    <p>Ville organisatrice : {{ sortie.campus.nom|title }}</p>
    <p>Lieu : {{ sortie.lieu.nom|title }}</p>
    <p>Rue : {{ sortie.lieu.rue }}</p>
    <p>Code postal : {{ sortie.lieu.ville.codePostal }}</p>
    <p>Ville : {{ sortie.lieu.ville.nom|title }}</p>
    <p>Ville : {{ sortie.lieu.latitude }}</p>
    <p>Ville : {{ sortie.lieu.longitude }}</p>
    <div>
        <h3>Liste des participants inscrits</h3>
        <table class="table table-striped table-hover" id="listParticipants">
            <thead>
            <tr>
                <th scope="col">Pseudo</th>
                <th scope="col">Nom</th>

            </tr>
            </thead>
            <tbody>
            {% for participant in sortie.participants %}
                <tr>
                    <td>{{ participant.pseudo|capitalize }}</td>
                    {# TODO mettre le lien pour afficher le profil user #}
                    <td><a href="">{{ [participant.prenom, participant.nom]|join(' ') }}</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% if sortie.etat.libelle == "Ouverte" %}
        <button id="inscription">S'inscrire</button>
        <button id="desinscription">Se désister</button>
        {% endif %}
    </div>

{% endblock %}

{% block extraJs %}
    <script>
        document.getElementById('inscription').addEventListener('click', function (evt) {
            fetch("{{ url('participant_inscription', {'id':sortie.id}) }}")
                .then(function (response){
                    return response.json();
                }).then(function (data){
                var refTable = document.getElementById('listParticipants');
                refTable.children[1].innerHTML = '';
                for (let participant of data) {
                    var nouvelleLigne = refTable.children[1].insertRow();

                    var cellulePseudo = nouvelleLigne.insertCell(0);
                    var pseudo = document.createTextNode(participant.pseudo.charAt(0).toUpperCase() + participant.pseudo.slice(1))
                    cellulePseudo.appendChild(pseudo);

                    var celluleNom = nouvelleLigne.insertCell(1);
                    var nom = document.createTextNode(participant.nom.charAt(0).toUpperCase() + participant.nom.slice(1))
                    celluleNom.appendChild(nom);
                }
            });
        });
        document.getElementById('desinscription').addEventListener('click', function (evt) {
            fetch("{{ url('participant_desinscription', {'id':sortie.id}) }}")
                .then(function (response){
                    return response.json();
                }).then(function (data){
                var refTable = document.getElementById('listParticipants');
                refTable.children[1].innerHTML = '';
                for (let participant of data) {
                    var nouvelleLigne = refTable.children[1].insertRow();

                    var cellulePseudo = nouvelleLigne.insertCell(0);
                    var pseudo = document.createTextNode(participant.pseudo.charAt(0).toUpperCase() + participant.pseudo.slice(1))
                    cellulePseudo.appendChild(pseudo);

                    var celluleNom = nouvelleLigne.insertCell(1);
                    var nom = document.createTextNode(participant.nom.charAt(0).toUpperCase() + participant.nom.slice(1))
                    celluleNom.appendChild(nom);
                }
            });
        });
    </script>
{% endblock %}

